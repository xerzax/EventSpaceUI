@page "/login"
@using EventSpaceUI.Client.Utilities
@inject HttpClient HttpClient
@inject IApiService _apiService
@inject IJSRuntime jsRuntime
@inject NavigationManager navManager


<div class="container-fluid p-0">
    <!----------------------- Login Container -------------------------->
    <div class="row justify-content-center align-items-center min-vh-100">
        <div class="col-md-8">
            <div class="row border rounded-5 p-3 bg-dark shadow box-area ">
                <!--------------------------- Left Box ----------------------------->
                <div class="col-md-6 rounded-4 d-flex justify-content-center align-items-center flex-column left-box">
                    <div class="featured-image mb-3">
                        <img src="images/vector2.png" class="img-fluid rounded-start" style="width: 80%;" alt="...">
                    </div>
                    <h3 class="text-white fs-3">Hello, Again</h3>
                    <small class="text-secondary text-center" style="width: 17rem;">Join experienced Designers on this platform.</small>
                </div>
                <!--------------------------- Right Box ----------------------------->
                <div class="col-md-6 right-box">
                    <div class="row align-items-center">
                        <div class="header-text text-center mb-4 text-white">
                            <h2>Login</h2>
                            <p>We are happy to have you back.</p>
                        </div>
                        <form @onsubmit="LoginUser" class="w-100">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control form-control-lg bg-light fs-6" placeholder="Email address" @bind="loginModel.Email">
                            </div>
                            <div class="input-group mb-1">
                                <input type="password" class="form-control form-control-lg bg-light fs-6" placeholder="Password" @bind="loginModel.Password">
                            </div>
                            <div class="input-group mb-4 d-flex justify-content-between align-items-center">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="formCheck" @bind="loginModel.RememberMe">
                                    <label for="formCheck" class="form-check-label text-secondary"><small>Remember Me</small></label>
                                </div>
                                <div class="forgot">
                                    <small><a href="#" class="text-info">Forgot Password?</a></small>
                                </div>
                            </div>
                            <div class="input-group mb-3">
                                <button type="submit" class="btn btn-lg btn-danger w-100 fs-6">Login</button>
                            </div>
                            <div class="row">
                                <small class="text-white-50">Don't have account? <a href="/register" class="text-info">Sign Up</a></small>
                            </div>
                        </form>
                        @if (!string.IsNullOrEmpty(loginResultMessage))
                        {
                            <p class="text-center mt-3 text-white">@loginResultMessage</p>
                        }
                        @if (!string.IsNullOrEmpty(token))
                        {
                            <p class="text-center mt-3 text-white">JWT Token: @token</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private LoginModel loginModel = new LoginModel();
    private string loginResultMessage;
    private string token;

    public class LoginModel
    {
        public string Email { get; set; }
        public string Password { get; set; }
        public bool RememberMe { get; set; } = true;
    }

    public class LoginResponseDto
    {
        public string Message { get; set; }
        public string Token { get; set; }
    }

    private async Task LoginUser()
    {
        var endpoint = "Account/login";
        var response = await _apiService.Login(loginModel);

        if (response == "Login successful")
        {
            // Login successful
            loginResultMessage = response;
            navManager.NavigateTo("/eventindex");
            await jsRuntime.InvokeVoidAsync("toastr.success", "Login Successful!");
            // Retrieve the token from the service
        }
        else
        {
            // Login failed
            loginResultMessage = response;
            await jsRuntime.InvokeVoidAsync("toastr.error", "Login Failed", "Invalid Login");
        }
    }
}
